<h1>Categoies_index</h1>

<div class="container">
  <div class="row gx-2">
    <div class="col-3 border p-3">
      <p class="lead">投稿エリア</p>

      <%= form_with model: @category do |f| %>
        <div class="category-post-area mb-3">
          <%= f.label :title, class: 'form-label fw-bold' %><br>
          <%= f.text_field :title %>
        </div>
        <div class="todos-post-area mb-3">
          <%= f.fields_for :todos do |t| %>
            <%= t.label :content, class: 'form-label fw-bold' %><br>
            <% 5.times do %>
              <%= t.text_field :content %>
            <% end %>
          <% end %>
        </div>
        <%= f.submit '投稿' %>
      <% end %>
    </div>

    <div class="col-6 border p-3">
      <p class="lead">indexエリア</p>
      <%# N+1問題に注意 %>
      <% @categories.each do |category| %>
        <div class="todo-list-area border p-2 my-2">
          <div class="category-title-area fw-bold">
            <%= category.title %>
            <button type="button" class="btn btn-outline-danger pull-right">
              <%= link_to '完了', category_path(category.id), method: :delete,
              data: { confirm: "ToDo「#{category.title}」を完了します。よろしいですか？" } %>
            </button>
          </div>
          <div class="todos-content-area">
            <% category.todos.active.each do |todo| %>
              <%= todo.content %>
              <button type="button" class="btn btn-outline-danger text-right">
                <%= link_to '完了', category_todo_path(todo.category.id, todo.id), method: :delete,
                data: { confirm: "ToDo「#{category.title}」を完了します。よろしいですか？" } %>
              </button>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <div class="col-3 border p-3">
      <p class="lead">ユーザーエリア(demo)</p>
      <div>
      ・ユーザー名: sample<br>
      ・残カテゴリ数: <%= "#{Category.active.count}" %><br>
      ・達成カテゴリ数: <%= "#{Category.all.count - Category.active.count} / #{Category.all.count}" %><br>
      </div>
    </div>
  </div>
</div>